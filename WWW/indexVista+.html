<!DOCTYPE HTML>
<html>
<head>
    <title>Welcome to Vista+</title>

    <script src="dependencies/jquery/jquery.min.js"></script>
    <script src="dependencies/vis/vis-network.min.js"></script>
    <script src="dependencies/html2canvas/html2canvas.min.js"></script>
    <script src="dependencies/materialize-css/js/materialize.min.js"></script>


    <script src="source/vista.js"></script>
    <link rel="stylesheet" href="source/vista.css">
    <meta charset="utf-8" />
    <link rel="shortcut icon" href="fav.ico" />


    <!-- Animate.css -->
    <link rel="stylesheet" href="css/animate.css">
    <!-- Icomoon Icon Fonts-->
    <link rel="stylesheet" href="css/icomoon.css">
    <!-- Bootstrap  -->
    <link rel="stylesheet" href="css/bootstrap.css">
    <!-- Magnific Popup -->
    <link rel="stylesheet" href="css/magnific-popup.css">
    <!-- Owl Carousel -->
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <link rel="stylesheet" href="css/owl.theme.default.min.css">
    <!-- Theme style  -->
    <link rel="stylesheet" href="css/style.css">
    <!-- Modernizr JS -->
    <script src="js/modernizr-2.6.2.min.js"></script>


</head>
<body>

    <div class="colorlib-loader"></div>

    <div id="page">

        <!-- NAVIGATE MENU-->
        <nav class="colorlib-nav" role="navigation">
            <div class="nav-content">
                <a href="" download="save.png" id="imageDownloadTrigger" style="margin-right: 60px;" class="btn-floating btn-large halfway-fab waves-effect waves-light teal amber hide">
                    <i class="material-icons unselectable">get_app</i>
                </a>
                <a id="dataSelectionTrigger" class="modal-trigger btn-floating btn-large halfway-fab waves-effect waves-light teal pulse hide"
                   href="#dataSelectionModal">
                    <i class="material-icons unselectable">list</i>
                </a>
            </div>
            <div class="top-menu">
                <div class="container">
                    <div class="row">
                        <div class="col-md-2">
                            <div id="colorlib-logo"><a href="indexVista+.html">Vista+</a></div>
                        </div>
                        <div class="col-md-10 text-right menu-1">
                            <ul>
                                <li class="active"><a href="indexVista+.html">Home</a></li>
                                <li class="active"><a href="infopage.html">How It Works?</a></li>

                            </ul>
                        </div>

                    </div>
                    <div class="row">
                        <div class="card-panel outer" style="padding: 0px;">

                            <ul id="visualMethodSelector" class="tabs">
                                <li id="methodGazePath" data-type="GAZEPATH" class="tab col s2 disabled"><a class="active" href="#">GazePath</a></li>
                                <li id="methodSTAMap" data-type="STAMAP" class="tab col s2 disabled"><a href="#">STA</a></li>
                            </ul>
                        </div>



                    </div>

                </div>
            </div>
        </nav>
        <!-- NAVIGATE MENU ENDING-->
        
        <!--TOP SECTION STARTED-->
        <!-- COVER PHOTO HERE-->
        <section id="home" class="video-hero" style="height: 700px; background-image: url(images/cover_img_1.jpg);  background-size:cover; background-position: center center;background-attachment:fixed;" data-section="home">
        <div class="overlay"></div>

           

          <div class="display-t text-center">
                <div class="display-tc">
                    <div class="container">
                        <div class="col-md-12 col-md-offset-0">
                            <div class="animate-box">
                                <h2>VISUALIZE YOUR DATA NOW !</h2>
                                <p>Middle East Technical University,2020</p>

                             

                                    <label id="dataAddTrigger" class="btn-floating blue waves-effect waves-light">
                                        <input style="display: none;" type="file" name="file[]" onchange='vistaModule.readFile(this)'
                                               multiple />
                                        <i class="btn btn-primary btn-lg btn-custom">Click to Upload Your Data!</i>
                                    </label>

                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>




        </section>
        <!--END OF TOP SECTION-->


        <!-- Animated SS of program will be added Here-->
        <div class="colorlib-featured">
            <div class="row animate-box">
                <div class="featured-wrap">
                    <div class="owl-carousel">
                        <div class="item">
                            <div class="col-md-8 col-md-offset-2">
                                <div class="featured-entry">
                                    <img class="img-responsive" src="images/banner.png" alt="">
                                </div>
                            </div>
                        </div>
                        <div class="item">
                            <div class="col-md-8 col-md-offset-2">
                                <div class="featured-entry">
                                    <img class="img-responsive" src="images/ncc.jpg" alt="">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div> <!-- Animated SS of program will be added Here-->
        
        
        <!-- DEVELOPER & PROJECT INFO PART -->
        <!--<div class="row">
            <div class="col-md-3 text-center animate-box">
                <div class="staff-entry">
                    <a href="#" class="staff-img" style="background-image: url(images/person1.jpg);"></a>
                    <div class="desc">
                        <h3>Emily Turner</h3>
                        <span>Developer</span>
                        <p>A small river named Duden flows by their place and supplies it with the necessary regelialia.</p>
                        <p>
                            <ul class="colorlib-social-icons">
                                <li><a href="#"><i class="icon-twitter"></i></a></li>
                                <li><a href="#"><i class="icon-facebook"></i></a></li>
                                <li><a href="#"><i class="icon-linkedin"></i></a></li>
                                <li><a href="#"><i class="icon-dribbble"></i></a></li>
                            </ul>
                        </p>
                    </div>
                </div>
            </div>



            <div class="col-md-3 text-center animate-box">
                <div class="staff-entry">
                    <a href="#" class="staff-img" style="background-image: url(images/person1.jpg);"></a>
                    <div class="desc">
                        <h3>Emily Turner</h3>
                        <span>Developer</span>
                        <p>A small river named Duden flows by their place and supplies it with the necessary regelialia.</p>
                        <p>
                            <ul class="colorlib-social-icons">
                                <li><a href="#"><i class="icon-twitter"></i></a></li>
                                <li><a href="#"><i class="icon-facebook"></i></a></li>
                                <li><a href="#"><i class="icon-linkedin"></i></a></li>
                                <li><a href="#"><i class="icon-dribbble"></i></a></li>
                            </ul>
                        </p>
                    </div>
                </div>
            </div>


            <div class="col-md-3 text-center animate-box">
                <div class="staff-entry">
                    <a href="#" class="staff-img" style="background-image: url(images/person2.jpg);"></a>
                    <div class="desc">
                        <h3>Adam Morris</h3>
                        <span>Developer</span>
                        <p>A small river named Duden flows by their place and supplies it with the necessary regelialia.</p>
                        <p>
                            <ul class="colorlib-social-icons">
                                <li><a href="#"><i class="icon-twitter"></i></a></li>
                                <li><a href="#"><i class="icon-facebook"></i></a></li>
                                <li><a href="#"><i class="icon-linkedin"></i></a></li>
                                <li><a href="#"><i class="icon-dribbble"></i></a></li>
                            </ul>
                        </p>
                    </div>
                </div>
            </div>

            <div class="col-md-3 text-center animate-box">
                <div class="staff-entry">
                    <a href="#" class="staff-img" style="background-image: url(images/person3.jpg);"></a>
                    <div class="desc">
                        <h3>Noah Nelson</h3>
                        <span>Designer</span>
                        <p>A small river named Duden flows by their place and supplies it with the necessary regelialia.</p>
                        <p>
                            <ul class="colorlib-social-icons">
                                <li><a href="#"><i class="icon-twitter"></i></a></li>
                                <li><a href="#"><i class="icon-facebook"></i></a></li>
                                <li><a href="#"><i class="icon-linkedin"></i></a></li>
                                <li><a href="#"><i class="icon-dribbble"></i></a></li>
                            </ul>
                        </p>
                    </div>
                </div>
            </div>

            <div class="col-md-3 text-center animate-box">
                <div class="staff-entry">
                    <a href="#" class="staff-img" style="background-image: url(images/person4.jpg);"></a>
                    <div class="desc">
                        <h3>Dorothy Murphy</h3>
                        <span>Designer</span>
                        <p>A small river named Duden flows by their place and supplies it with the necessary regelialia.</p>
                        <p>
                            <ul class="colorlib-social-icons">
                                <li><a href="#"><i class="icon-twitter"></i></a></li>
                                <li><a href="#"><i class="icon-facebook"></i></a></li>
                                <li><a href="#"><i class="icon-linkedin"></i></a></li>
                                <li><a href="#"><i class="icon-dribbble"></i></a></li>
                            </ul>
                        </p>
                    </div>
                </div>
            </div>
        </div>-->
        <!--DEVELOPER PART FINISHED-->

    </div>
    
    <!-- TO TOP NAVIGATE ARROW-->
    <div class="gototop js-top">
        <a href="#" class="js-gotop"><i class="icon-arrow-up2"></i></a>
    </div>
    

    <!-- jQuery -->
    <script src="js/jquery.min.js"></script>
    <!-- jQuery Easing -->
    <script src="js/jquery.easing.1.3.js"></script>
    <!-- Bootstrap -->
    <script src="js/bootstrap.min.js"></script>
    <!-- Waypoints -->
    <script src="js/jquery.waypoints.min.js"></script>
    <!-- Stellar Parallax -->
    <script src="js/jquery.stellar.min.js"></script>
    
    <!-- Owl carousel -->
    <script src="js/owl.carousel.min.js"></script>
    <!-- Magnific Popup -->
    <script src="js/jquery.magnific-popup.min.js"></script>
    <script src="js/magnific-popup-options.js"></script>
    <!-- Counters -->
    <script src="js/jquery.countTo.js"></script>
    <!-- Main -->
    <script src="js/main.js"></script>

</body>


<script type="text/javascript">
    var settings = {
        sta: {
            daccuracy: 0.5,
            sizeOfScreen: 17,
            distance: 60,
            resX: 1280,
            resY: 1024,
            tlevel: 1.00,
            hfidelity: true
        },
        staAddress: "http://127.0.0.1:5000"
    };

    var discovery = true;
    var selectedStimuliName = "";
    var selectedVisualMethod = "GAZEPATH";
    var prevVisualMethod = "";
    var filter = new Array();
    var vistaModule;
    var mapContainer = document.getElementById('map');
    var listContainer = "map";
    var listener = function (response) {

        if (response == "DATACHANGE") {
            updateDataList();
        } else if (response == "LOADERSTART") {
            showLoader();
        } else if (response == "LOADEREND") {
            removeLoader();
        } else if (response == "UPDATEAOIS") {
            controlVisualMethods();
            drawAOIs();
        } else if (response == "IMGDOWNLOAD") {
            showDownloadLink(vistaModule.getDownloadImage());
        }
    }

    function createDataSelectionList() {
        var list = vistaModule.getListOfCategories();
        var ulHTML = "";
        for (var i = 0; list.length > i; i++) {
            var element = list[i];

            filter[element["name"]] = {
                participants: element["participants"],
                img: null
            };

            var liHTML = '<li data-stimuliname="' + element["name"] + '">' +
                '<div class="collapsible-header">';
            if (element["title"] == null) {
                liHTML +=
                    '<i class="material-icons unselectable">filter_drama</i>' + element["name"] + '</div>';
            } else {
                liHTML +=
                    '<i class="material-icons unselectable">filter_drama</i>' + element["title"] + '</div>';
            }
            liHTML +=
                '<div style="padding: 10px;" class="collapsible-body">' +
                '<form class="col s12" action="#">' +
                '<div class="row">' +
                '<p>Participants</p>';

            for (var j = 0; element["participants"].length > j; j++) {
                var innerElement = element["participants"][j];
                liHTML += '<div class="input-field col s3" id="">' +
                    '<input type="checkbox" value="1" class="participant" data-name="' + element["name"] + '" data-participant="' + innerElement + '" id="check-' + i + '-' + innerElement + '" checked/>' +
                    '<label for="check-' + i + '-' + innerElement + '">Participant ' + innerElement + '</label>' +
                    '</div>';
            }

            liHTML +=
                '<div class="input-field col s12">' +
                '<div class="file-field input-field">' +
                '<div class="waves-effect waves-light btn red">' +
                '<i class="material-icons">insert_photo</i>' +
                '<input class="imgurl" placeholder="Image URL" data-name="' + element["name"] + '" id="' + element["name"] + '_IMG" type="file">' +
                '</div>' +
                '<div class="file-path-wrapper">' +
                '<input id="' + element["name"] + '_URL" class="file-path validate" type="text" value="">' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</form>' +
                '</div>' +
                '</li>';

            ulHTML += liHTML;
        }
        return ulHTML;
    }

    function updateDataList() {
        $('#dataSelectionTrigger').removeClass("hide");
        $('#dataSelectionTrigger').addClass('pulse');
        $('#dataSelectionList').html(createDataSelectionList());
    }

    function showLoader() {
        $('#mapLoader').removeClass("hide");
        $('#mapLoader').show();
        $('#background').addClass("hide");
        $('#imageDownloadTrigger').addClass("hide");
        $('#map').css("opacity", "0");
    }

    function removeLoader() {
        $('#mapLoader').hide();
        $('#background').removeClass("hide");
        $('#map').css("opacity", "1");
        vistaModule.createDownloadImage(selectedStimuliName);
    }

    function showDownloadLink(imgLink) {
        $('#imageDownloadTrigger').attr("href", imgLink);
        $('#imageDownloadTrigger').removeClass("hide");
    }

    function controlVisualMethods() {
        if (!vistaModule.isSTAMAPApplicable()) {
            $('#methodSTAMap').addClass("disabled");
        } else {
            $('#methodSTAMap').removeClass("disabled");
        }
    }

    function resetVisualMethods() {
        prevVisualMethod = "GAZEPATH";
        selectedVisualMethod = "GAZEPATH";
        $('#visualMethodSelector').find("li").removeClass("disabled");
        $('#visualMethodSelector').find("a").removeClass("active");
        $('#methodGazePath').find("a").addClass("active");
        vistaModule.addAOIBlock(false);
        controlVisualMethods();
    }

    function clearAOIs() {
        $('#map').parent().find('.aois').remove();
    }

    function drawAOIs() {
        if (selectedVisualMethod == "GAZEPATH") {
            clearAOIs();
            $('#map').parent().append(vistaModule.getAOIHTML());
        }
    }


    $(document).ready(function () {
        $('.modal').modal();
        $('select').material_select();

        var size = {
            dataW: 1280,
            dataH: 1024,
            width: 0,
            height: 0
        }

        $('#dataSelectionList').delegate("li", "click", function () {
            selectedStimuliName = $(this).data("stimuliname");
        });

        $('#dataSelectionButton').on("click", function () {
            resetVisualMethods();
            vistaModule.removeAOIs();
            vistaModule.showGazePath(selectedStimuliName, filter[selectedStimuliName]);
        });

        $('#dataSelectionList').delegate(".participant", "click", function () {
            if ($(this).val() == 1) {
                var participants = new Array();
                var index = filter[$(this).data("name")].participants.indexOf($(this).data("participant"));
                for (var i = 0; filter[$(this).data("name")].participants.length > i; i++) {
                    if (i != index) {
                        participants.push(filter[$(this).data("name")].participants[i]);
                    }
                }
                filter[$(this).data("name")].participants = participants;
                $(this).val(0);
            } else {
                filter[$(this).data("name")].participants.push($(this).data("participant"));
                $(this).val(1);
            }
        });

        $('#dataSelectionList').delegate(".imgurl", "change", function () {
            var file = $(this).prop('files')[0];
            var name = $(this).data("name");

            if (file) {
                var reader = new FileReader();
                reader.onload = function () {
                    filter[name].img = reader.result;
                }
                reader.readAsDataURL(file);
            } else {
                filter[$(this).data("name")].img = null;
            }
        });

        $('#visualMethodSelector').delegate("li", "click", function (event) {
            event.preventDefault();
            if (!$(this).hasClass("disabled") && selectedStimuliName != "") {
                selectedVisualMethod = $(this).data("type");
                if (selectedVisualMethod != prevVisualMethod) {
                    if (selectedVisualMethod == "GAZEPATH") {
                        drawAOIs();
                        vistaModule.showGazePath(selectedStimuliName);
                        vistaModule.addAOIBlock(false);
                    } else if (selectedVisualMethod == "STAMAP") {
                        clearAOIs();
                        vistaModule.showSTAMap(selectedStimuliName, settings.sta, filter[selectedStimuliName]);
                        vistaModule.addAOIBlock(true);
                    }
                    prevVisualMethod = selectedVisualMethod;
                    $(this).parent().find("a").removeClass("active");
                    $(this).find("li").addClass("active");
                }
            }
        });

        $('#menuTrigger').on('click', function (event) {
            if (discovery == true) {
                $('#menuTriggerTab').tapTarget('close');
                event.preventDefault();
            }

        });

        $('#dataSelectionTrigger').on('click', function () {
            $(this).removeClass('pulse');
        });

        $('#managementButton').on('click', function () {
            if ($('#setting_width').val() != "") {
                settings.sta.resX = $('#setting_width').val();
            } else {
                $('#setting_width').val(settings.sta.resX);
            }

            if ($('#setting_height').val() != "") {
                settings.sta.resY = $('#setting_height').val();
            } else {
                $('#setting_height').val(settings.sta.resY);
            }

            if ($('#setting_inch').val() != "") {
                settings.sta.sizeOfScreen = $('#setting_inch').val();
            } else {
                $('#setting_inch').val(settings.sta.sizeOfScreen);
            }

            if ($('#setting_distance').val() != "") {
                settings.sta.distance = $('#setting_distance').val();
            } else {
                $('#setting_distance').val(settings.sta.distance);
            }

            if ($('#setting_daccuracy').val() != "") {
                settings.sta.daccuracy = $('#setting_daccuracy').val();
            } else {
                $('#setting_daccuracy').val(settings.sta.daccuracy);
            }
            if ($('#setting_tolarancelevel').val() != "") {
                settings.sta.tlevel = $('#setting_tolarancelevel').val();
            } else {
                $('#setting_tolarancelevel').val(settings.sta.tlevel);
            }
            if ($('#setting_highestfidelity').is(":checked")) {
                settings.sta.hfidelity = true;
            } else {
                settings.sta.hfidelity = false;
            }
        });


        size.width = $('#map').width();
        size.height = size.width * (size.dataH / size.dataW);
        $('#map').height(size.height);

        $('#mapLoader').css("left", (size.width - $('#mapLoader').width()) / 2);
        $('#mapLoader').css("top", (size.height - $('#mapLoader').height()) / 2);

        vistaModule = new vista(listener, mapContainer, size, settings.staAddress);
        vistaModule.addAOIBlock(true);
        $('#menuTriggerTab').tapTarget('open');

        $('#setting_width').val(settings.sta.resX);
        $('#setting_height').val(settings.sta.resY);
        $('#setting_inch').val(settings.sta.sizeOfScreen);
        $('#setting_distance').val(settings.sta.distance);
        $('#setting_daccuracy').val(settings.sta.daccuracy);
        $('#setting_tolarancelevel').val(settings.sta.tlevel);
        $('#setting_higestfidelity').prop('checked', settings.sta.hfidelity);

        //Handles resize event
        $(window).bind('resize', function (event) {
            if (window.RT) {
                clearTimeout(window.RT);
            }
            window.RT = setTimeout(function () {
                this.location.reload(false);
            }, 100);
        });
    });
</script>
</html>

